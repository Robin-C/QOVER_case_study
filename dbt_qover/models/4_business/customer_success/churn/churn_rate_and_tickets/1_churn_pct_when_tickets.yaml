version: 2

metrics:
  - name: churn_rate_when_tickets_open
    label: Churn rate when ticket open
    description: "For 100 policy holders that have ever opened a ticket, how many of them have eventually churned. The lower the better."

    calculation_method: derived
    expression: "{{ metric('count_policyholders_churn_period_with_ticket_open')}} / case when {{metric('count_contract_with_ticket_ever_open')}} = 0 then 1 else {{metric('count_contract_with_ticket_ever_open')}} end * 100"
    dimensions:
      - year_month
      - cancel_reason