version: 2

metrics:
  - name: churn_rate_by_cancel_reason
    label: Churn Rate reason %
    description: "This is how the churn rate is explained for each month by reason"

    calculation_method: derived
    expression: "{{ metric('policyholders_churn_period')}} / case when {{metric('churned_policyholders_count_beginning_period')}} = 0 then 1 else {{metric('churned_policyholders_count_beginning_period')}} end * 100"

    dimensions:
      - year_month